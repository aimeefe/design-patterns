# å‘å¸ƒ-è®¢é˜…æ¨¡å¼

åˆç§°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚

## å®ç°ä¸€ä¸ªé€šç”¨çš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ¨¡æ¿

- é¦–å…ˆåˆ¶å®šå¥½è°å……å½“å‘å¸ƒè€…
- ç„¶åç»™å‘å¸ƒè€…æ·»åŠ ä¸€ä¸ªç¼“å­˜åˆ—è¡¨ï¼Œç”¨äºå­˜æ”¾å›è°ƒå‡½æ•°ä»¥ä¾¿é€šçŸ¥è®¢é˜…è€…
- æœ€åå‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™ï¼Œå‘å¸ƒè€…ä¼šéå†è¿™ä¸ªç¼“å­˜åˆ—è¡¨ï¼Œä¸€æ¬¡è§¦å‘é‡Œé¢å­˜æ”¾çš„è®¢é˜…è€…å›è°ƒå‡½æ•°

ä»£ç å¦‚ä¸‹ï¼š

```JavaScript
// å‘å¸ƒè€…
const event = {
  clientList: [],

  // æ”¶é›†è®¢é˜…
  listen: function (key, fn) {
    if (!this.clientList[key]) {
      this.clientList[key] = [];
    }
    //è®¢é˜…çš„æ¶ˆæ¯æ·»åŠ åˆ°ç¼“å­˜åˆ—è¡¨
    this.clientList[key].push(fn); 
  },

  // è§¦å‘è®¢é˜…
  trigger: function () {
    const key = [].shift.call(arguments);
    const fns = this.clientList[key];

    if (!fns || fns.length === 0) {
      return false;
    }

    for (fn of fns) {
      fn.apply(this, arguments);
    }
  },

  // ç§»é™¤è®¢é˜…äº‹ä»¶
  remove: function (key, fn) {
    const fns = this.clientList[key];

    // å¦‚æœ key å¯¹åº”çš„æ¶ˆæ¯æ²¡æœ‰è¢«è®¢é˜…ï¼Œåˆ™ç›´æ¥è¿”å›
    if (!fns) {
      return false;
    }

    if (!fn) {
      //å¦‚æœæ²¡æœ‰ä¼ å…¥å…·ä½“çš„å›è°ƒå‡½æ•°ï¼Œæ ‡è¯†éœ€è¦å–æ¶ˆ key å¯¹åº”æ¶ˆæ¯çš„æ‰€æœ‰è®¢é˜…
      fns && (fns.length = 0)
    } else {
      // åˆ é™¤è®¢é˜…è€…çš„å›è°ƒå‡½æ•°
      fns.forEach((value, key) => {
        if (value === fn) {
          fns.splice(key, 1);
        }
      });
    }
  }
}

// å®šä¹‰ installEventï¼Œå®ƒå¯ä»¥ç»™æ‰€æœ‰å¯¹è±¡åŠ¨æ€å®‰è£…å‘å¸ƒ - è®¢é˜…åŠŸèƒ½
const installEvent = obj => {
  for (let i in event) {
    obj[i] = event[i];
  }
}
```

ğŸƒåŸºäºä¸Šé¢æ¨¡æ¿ï¼Œæ¥å®ç°å‡ ä¸ªä¾‹å­ï¼š

###### demo01ï¼šå°æ˜ç­‰äººå»å”®æ¥¼å¤„ä¹°æˆ¿ï¼Œä½†æ˜¯åˆ°äº†å”®æ¥¼å¤„è¢«å‘ŠçŸ¥å·²å”®ç½„ï¼Œé”€å”®äººå‘˜å‘Šè¯‰ä»–ä¸ä¹…åè¿˜æœ‰ä¸€äº›å°¾ç›˜æ¨å‡ºï¼Œå¼€å‘å•†æ­£åœ¨åŠç†æ‰‹ç»­ï¼Œæ‰‹ç»­å¥½åä¾¿å¯è´­ä¹°ï¼Œä½†æ˜¯å…·ä½“ä»€ä¹ˆæ—¶å€™ä¸æ¸…æ¥šï¼Œå°æ˜åœ¨ç¦»å¼€å‰ï¼ŒæŠŠç”µè¯å·ç ç•™åœ¨äº†å”®æ¥¼å¤„ï¼Œé”€å”®äººå‘˜ç­”åº”ä»–æ–°æ¥¼ç›˜ä¸€æ¨å‡ºé©¬ä¸Šå‘æ¶ˆæ¯ç»™ä»–ä»¬ï¼Œä»–ä»¬çš„ç”µè¯å·ç è¢«è®°åœ¨å”®æ¥¼å¤„çš„å‘åå†Œä¸Šï¼Œæ–°æ¥¼ç›˜æ¨å‡ºçš„æ—¶å€™ï¼Œé”€å”®äººå‘˜ä¼šç¿»å¼€èŠ±åå†Œï¼Œéå†ä¸Šé¢çš„ç”µè¯å·ç ï¼Œä¸€æ¬¡å‘é€ä¸€æ¡çŸ­ä¿¡æ¥é€šçŸ¥ä»–ä»¬ã€‚

```JavaScript

// ç»™å”®æ¥¼å¤„å¯¹è±¡ salesOffices åŠ¨æ€æ·»åŠ å‘å¸ƒ-è®¢é˜…åŠŸèƒ½
const salesOffices = {};
installEvent(salesOffices);

// è®¢é˜…è€…ï¼Œç›‘å¬å‘å¸ƒè€…æ¶ˆæ¯
salesOffices.listen('squareMeter88', fn1 = price => {
  console.log(`fn1:88å¹³ç±³ä»·æ ¼ï¼š${price}`);
})
salesOffices.listen('squareMeter100', fn2 = price => {
  console.log(`fn2:100å¹³ç±³ä»·æ ¼ï¼š${price}`);
})
salesOffices.listen('squareMeter100', fn3 = price => {
  console.log(`fn3:100å¹³ç±³ä»·æ ¼ï¼š${price}`);
})

// fn1ã€fn2 ä¸æƒ³ä¹°æˆ¿å­äº†ï¼Œå‘å¸ƒè€…å¯ä»¥å–æ¶ˆä»–ä»¬çš„è®¢é˜…
salesOffices.remove('squareMeter88', fn1); //ç§»é™¤fn1çš„è®¢é˜…
salesOffices.remove('squareMeter100', fn3); //ç§»é™¤fn3çš„è®¢é˜…

// å‘å¸ƒè€…å¼€å§‹å‘é€æ¶ˆæ¯
salesOffices.trigger('squareMeter100', 3000000); //fn2:100å¹³ç±³ä»·æ ¼ï¼š3000000
```

###### demo02ï¼šå•†åŸå¼€å‘ï¼Œç½‘ç«™é‡Œçš„ header å¤´éƒ¨ã€nav å¯¼èˆªç­‰æ¨¡å—åœ¨æ¸²æŸ“çš„æ—¶å€™éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„å‰æï¼Œå°±æ˜¯éœ€è¦è¯·æ±‚åç«¯æ¥å£æ•°æ®æ‹¿åˆ°ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œç„¶åæ ¹æ®ä¿¡æ¯æ¥æ¸²æŸ“å„è‡ªçš„æ¨¡å—ã€‚è‡³äºè¯·æ±‚æ¥å£æ•°æ®ä»€ä¹ˆæ—¶å€™èƒ½æˆæœè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªæ²¡æ³•ç¡®å®šï¼Œå¹¶ä¸”ï¼Œä»¥åå¯èƒ½ä¼šæ·»åŠ è¿›æ¥æ›´å¤šçš„ä¾èµ–ç™»å½•ä¿¡æ¯æ•°æ®çš„æ¨¡å—ã€‚ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„è¯ï¼Œå½“ç™»å½•æˆåŠŸæ—¶ï¼Œç™»å½•æ¨¡å—åªéœ€å‘å¸ƒç™»å½•æˆåŠŸçš„æ¶ˆæ¯ï¼Œè€Œä¸šåŠ¡é˜²æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°±ä¼šå¼€å§‹è¿›è¡Œå„è‡ªçš„ä¸šåŠ¡å¤„ç†ï¼Œç™»å½•æ¨¡å—ä¸éœ€è¦å…³å¿ƒä¸šåŠ¡æ–¹ç©¶ç«Ÿè¦åšä»€ä¹ˆï¼Œä¹Ÿä¸ç”¨å»äº†è§£ä»–ä»¬çš„å†…éƒ¨ç»†èŠ‚ã€‚

```JavaScript
// æ³¨å†Œ login å‘å¸ƒè€…
const login = {};
installEvent(login);

const btn = document.querySelector('#btn');


// æ¨¡æ‹Ÿç™»å½•ï¼Œç™»å½•æˆåŠŸåï¼Œå‘å¸ƒç™»å½•æˆåŠŸçš„æ¶ˆæ¯
btn.addEventListener('click', () => {
  console.log('ç™»å½•æˆåŠŸ');
  login.trigger('loginSuc', {
    avatar: 'http://img.qqzhi.com/uploads/2019-04-03/060633745.jpg'
  });
})


// å„æ¨¡å—ç›‘å¬ç™»å½•æˆåŠŸçš„æ¶ˆæ¯
const header = (() => {
  login.listen('loginSuc', data => {
    header.setAvatar(data.avatar);
  })
  return {
    setAvatar: avatar => {
      console.log(`å¤´åƒæ•°æ®ï¼š${avatar}`)
    }
  }
})()

const nav = (() => {
  login.listen('loginSuc', data => {
    nav.setAvatar(data.avatar);
  })
  return {
    setAvatar: avatar => {
      console.log(`å¯¼èˆªæ•°æ®ï¼š${avatar}`)
    }
  }
})()
```








